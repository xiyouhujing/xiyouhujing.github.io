---
title: 数据库笔记（二）
date: 2020-07-31 17:06:00
tags:
- 数据库
copyright: true
categories: 数据库
mathjax: true
---

## Oracle

### Oracle简介

- Oracle Database，又名Oracle RDBMS，或者简称Oracle，是甲骨文公司的一款关系数据库管理系统
- 是目前世界上使用最为广泛的数据库管理系统
- 适用于各类大、中、小型应用

### Oracle客户端工具

- Oracle SQL Developer：适合初学人员
- PL/SQL Developer：适合开发人员
- Toad for Oracle：适合DBA人员

### Oracle数据类型

VARCHAR2：存储可变长度的字符数据

CHAR：存储固定长度字符数据

NUMBER：存储零、正数、定长负数以及浮点数

FLOAT：38位十进制的浮点数

INTEGER：存储整数，若插入、更新的数值有小数，则会被四舍五入

DATE：存储日期类型，可以精确到秒

TIMESTAMP：和DATE相比，这个可以精确到纳秒，存储时间精度更高

CLOB：存储单字节和多字节字符数据，最多4GB

BLOB：没有字符集语义的比特流，一般是图像、声音、视频等文件，最多4GB

### Oracle数据库对象

数据库对象是数据库的组成部分，Oracle数据库常见的数据对象有：

- 表（Table）
- 视图（View）
- 索引（Index）
- 序列（sequence）
- 存储过程（Procedure）
- 函数（function）

### Oracle表的使用方法

#### 创建表的语法

```mysql
CREATE TABLE [schema.] table
			  (column datatype [DEFAULT exprl]
              		  [column_constraint],
              		  ···
              		  [table_constraint]).
```

示例：创建一张班级表，包括班级ID、班级名

```mysql
CREATE TABLE CLASSINFO(
	CLASSID NUMBER(2),
	CLASSNAME VARCHAR(10)
);
```

#### 表的使用方式

列约束：在Oracle中，一个安全的表，要通过建表时对表列设置约束的方式来实现，常用的列约束有：

- PRIMARY KEY：一个表只能建一个主键，并确保唯一；
- FOREIGN KEY：一列或者多列的组合作为外键，是同一表或者其他表的主键或唯一键；
- NOT NULL：指定列不接受NULL值；
- UNIQUE：指定存储在列中的每一个值都必须唯一；
- DEFAULT：default_vale：指定列的默认值

#### 修改表

**添加列**

```mysql
ALTER TABLE tablename
	ADD (column datatype [default expr]
         [, column datatype···])；
```

**修改列**

```mysql
ALTER TABLE tablename
	MODIFY (column datatype [default expr]
	[, column datatype]···);
```

**删除表**

```MySQL
DROP TABLE tablename；
```

#### Oracle索引

**索引**

- 一个排序的数据，用于提高查询效率的数据库对象
- 通过快速定位数据，减少磁盘的I/O
- 数据库服务自动使用和维护，删除或破坏索引不会对数据表造成影响

**索引的分类**

- 唯一索引：确保在所建列上只有一个唯一值（或值组合）
- 非唯一索引：提高检索速度
- 单列索引：只有一列
- 复合索引：有多列

**创建索引语法**

```mysql
CREATE INDEX index
	ON table (column[, column]···);
```

**查看索引结构语法**

```mysql
SELECT * FROM USER_IND_COLUMNS
	WHERE INDEX_NAME='indexname';
```

**删除索引语法**

```mysql
DROP INDEX indexname
```

#### Oracle视图

**什么是视图**

视图是由数据库表产生，它限制用户能看到和修改的结果

**视图的作用**

- 限制敏感数据的访问
- 简化查询
- 增加数据独立性
- 对于相同的数据，提供不同的展示

**创建视图语法**

```mysql
CREATE [OR REPLACE] [FORCE | NOFORCE] VIEW viewname
	[(alias[, alias]...)]
	AS subquery --查询字句
	[WITH CHECK OPTION [CONSTRAINT constraint]]
	[WITH READ ONLY]
```

**注释**：FORCE ，无论视图基于的表存在与否，都建立该视图，NOFORCE，若表不存在则不建该视图；CREATE OR REPLACE命令创建或修改视图

**查询视图语法**

```mysql
SELECT * FROM viewname;
```

**删除视图语法**

```mysql
DROP VIEW viewname;
```

#### Oracle序列

**什么是序列**

- 序列（SEQUENCE）是序列号生成器，可以为表中的行自动生成序列号；
- 产生一组等间隔的数值（类型为数字）
- 不占用磁盘空间，占用内存

**序列的作用**

- 主要用途是生成表的主键值，可以在插入语句中引用
- 可以通过查询检查当前值，或使序列增至下一个值

**创建序列语法**

```mysql
CREATE SEQUENCE sequencename        --指定序列的名称
	[INCREMENT BY n]                             --用于定义序列的增长步长
	[START WITH n]                                   --定义序列的初始值，默认为1
	[{MAXVALUE n | NOMAXVALUE}]    --定义序列能生成的最小值
	[{MINVALUE n | NOMINVALUE}]      --定义序列能生成的最小值
	[{CYCLE | NOCYCLE}]                           --当序列生成器的值达到上限后是否循环
	[{CACHE n | NOCACHE}];                    --在内存里预先存储一些序列号，提高速度，默认为20
```

**序列的属性**

NEXTVAL：返回下一个可用的序列值，每次返回一个唯一值，全局唯一

CURRVAL：获取当前的序列值

#### Oracle基本的SQL语句

SQL语句分类：SQL结构化查询语言，一共包括如下6类：

- 数据查询语言（DQL）：关键字包括SELECT、WHERE、ORDER BY、GROUP BY和HAVING等，主要作用使查询数据
- 指针控制语言（CCL）：关键字包括DECLARE CURSOR、FETCH INTO等，主要作用时通过游标读取数据
- 数据操作语言（DML）：关键字包括INSERT、UPDATE和DELETE等，主要作用是对数据进行修改
- 事务处理语言（TPL）：关键字包括BEGIN TRANSACTION、COMMIT和ROLLBACK等，主要作用是控制事务
- 数据定义语言（DDL）：关键字包括CREATE、DROP和TRUNCATE等，主要作用是管理数据库对象
- 数据控制语言（DCL）：关键字包括GRANT、REVOKE等，主要作用是对操作和数据进行赋权

**Oracle删除语句**

DELETE：删除表中数据

```mysql
DELETE [FROM] table [WHERE condition]
```

TRUNCATE：清空表中数据

```mysql
TRUNCATE TABLE table
```

注意：TRUNCATE命令是一次性把表中的数据全部删除，不记录事务日志，删除数据不能恢复，也不会激活与表有关的触发器，执行速度快；DELETE命令是每次从表中删除一行，并且删除操作记录到事务日志中，删除数据可以恢复，执行速度慢。

